<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Diagn√≥stico ROI - Eval√∫a la madurez de tu ecosistema de capacitaci√≥n seg√∫n la Metodolog√≠a ROI de Phillips. Quiz interactivo de MAS Consultores, √∫nico partner oficial del ROI Institute en Latinoam√©rica.">
<title>Diagn√≥stico de Madurez ROI ‚Äî Metodolog√≠a Phillips Nivel 5 | MAS Consultores</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;0,9..40,900;1,9..40,400&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
<style>
  :root {
    --bg-main:#ffffff; --bg-light:#f7f9fc;
    --navy:#1a2e4a; --navy2:#243d61; --navy3:#0f1f33; --navy-deep:#0c1929;
    --brand-morado:#833d8e; --brand-amarillo:#edb321; --brand-verde:#009739; --brand-rojo:#d62216; --brand-azul:#23398d;
    --nivel1:#833d8e; --nivel2:#edb321; --nivel3:#009739; --nivel4:#d62216; --nivel5:#23398d;
    --text:#334155; --muted:#64748b; --border:#e2e8f0; --border-light:#f1f5f9;
    --shadow-sm:0 1px 3px rgba(26,46,74,0.04),0 4px 6px -1px rgba(26,46,74,0.06);
    --shadow-md:0 4px 6px rgba(26,46,74,0.04),0 10px 25px -3px rgba(26,46,74,0.08);
    --shadow-lg:0 10px 15px rgba(26,46,74,0.04),0 20px 40px -5px rgba(26,46,74,0.12);
    --shadow-xl:0 25px 50px -12px rgba(26,46,74,0.18);
    --radius-sm:12px; --radius-md:18px; --radius-lg:24px; --radius-xl:32px;
  }
  *{margin:0;padding:0;box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{font-family:'DM Sans',system-ui,-apple-system,sans-serif;background:var(--bg-light);color:var(--text);overflow-x:hidden;line-height:1.7;-webkit-font-smoothing:antialiased;min-height:100vh}
  h1,h2,h3,h4{font-family:'Plus Jakarta Sans','DM Sans',sans-serif;color:var(--navy);line-height:1.15;letter-spacing:-0.02em}

  nav{position:fixed;top:0;width:100%;z-index:1000;background:rgba(255,255,255,0.95);backdrop-filter:blur(16px);border-bottom:1px solid var(--border)}
  .nav-inner{max-width:1180px;margin:auto;display:flex;align-items:center;justify-content:space-between;padding:0 24px;height:64px}
  .nav-back{color:var(--navy);text-decoration:none;font-size:13px;font-weight:600;display:flex;align-items:center;gap:6px;transition:color .2s}
  .nav-back:hover{color:var(--brand-morado)}

  .quiz-wrapper{max-width:800px;margin:0 auto;padding:100px 24px 60px}

  .progress-container{margin-bottom:40px}
  .progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .progress-label{font-size:13px;font-weight:700;color:var(--navy);text-transform:uppercase;letter-spacing:1px}
  .progress-step-text{font-size:13px;color:var(--muted);font-weight:600}
  .progress-bar-track{width:100%;height:8px;background:var(--border);border-radius:50px;overflow:hidden}
  .progress-bar-fill{height:100%;border-radius:50px;transition:width .6s cubic-bezier(.16,1,.3,1),background .4s;width:0%}

  .step{display:none;animation:fadeStep .5s ease}
  .step.active{display:block}
  @keyframes fadeStep{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

  .step-card{background:#fff;border-radius:var(--radius-xl);padding:44px;box-shadow:var(--shadow-lg);border:1px solid var(--border-light)}
  .step-icon{font-size:40px;margin-bottom:16px;display:block}
  .step-title{font-size:clamp(22px,3.5vw,30px);font-weight:800;margin-bottom:8px}
  .step-subtitle{color:var(--muted);font-size:15px;margin-bottom:32px;line-height:1.6}

  .question-group{margin-bottom:28px}
  .question-label{font-size:14px;font-weight:700;color:var(--navy);margin-bottom:12px;display:block}

  .chips{display:flex;flex-wrap:wrap;gap:10px}
  .chip{padding:11px 20px;border-radius:50px;border:2px solid var(--border);background:#fff;font-size:14px;cursor:pointer;transition:all .25s;color:var(--text);font-family:inherit;font-weight:500}
  .chip:hover{border-color:var(--navy);background:var(--bg-light)}
  .chip.selected{background:var(--navy);color:#fff;border-color:var(--navy);transform:scale(1.03)}

  .phase-header{display:flex;align-items:center;gap:12px;margin-bottom:16px;margin-top:8px}
  .phase-dot{width:14px;height:14px;border-radius:50%;flex-shrink:0}
  .phase-name{font-size:15px;font-weight:800}
  .phase-desc{font-size:11px;color:var(--muted);font-weight:600;margin-left:auto;background:var(--bg-light);padding:3px 10px;border-radius:50px}
  .phase-divider{margin-top:32px;padding-top:4px}

  .check-item{display:flex;align-items:flex-start;gap:14px;padding:14px 16px;border-radius:var(--radius-sm);border:2px solid var(--border-light);background:#fff;cursor:pointer;transition:all .3s cubic-bezier(.16,1,.3,1);margin-bottom:8px;user-select:none}
  .check-item:hover{border-color:var(--border);background:var(--bg-light);transform:translateX(4px)}
  .check-item.checked{border-color:currentColor;background:color-mix(in srgb,currentColor 6%,white)}
  .check-box{width:24px;height:24px;border-radius:7px;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .3s cubic-bezier(.16,1,.3,1);margin-top:1px}
  .check-box svg{width:14px;height:14px;opacity:0;transform:scale(.5);transition:all .3s cubic-bezier(.16,1,.3,1)}
  .check-box svg path{stroke:#fff;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;fill:none;stroke-dasharray:24;stroke-dashoffset:24;transition:stroke-dashoffset .4s cubic-bezier(.16,1,.3,1) .1s}
  .check-item.checked .check-box{border-color:currentColor;background:currentColor;transform:scale(1.1)}
  .check-item.checked .check-box svg{opacity:1;transform:scale(1)}
  .check-item.checked .check-box svg path{stroke-dashoffset:0}
  .check-text{font-size:13.5px;line-height:1.55;font-weight:500}

  .check-counter{display:flex;align-items:center;justify-content:center;gap:8px;padding:10px 20px;border-radius:50px;background:var(--bg-light);border:1px solid var(--border);margin-bottom:22px;font-size:14px;font-weight:600;color:var(--navy)}
  .check-counter .count-num{font-weight:900;font-size:18px}

  .lead-icon{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--navy),var(--navy2));display:flex;align-items:center;justify-content:center;font-size:36px;margin:0 auto 20px}
  .form-group{margin-bottom:18px}
  .form-label{display:block;font-size:13px;font-weight:700;color:var(--navy);margin-bottom:8px}
  .form-input{width:100%;padding:14px 18px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:15px;background:var(--bg-light);transition:all .2s;outline:none;font-family:inherit}
  .form-input:focus{border-color:var(--navy);background:#fff;box-shadow:0 0 0 4px rgba(26,46,74,.06)}
  .form-input.error{border-color:var(--brand-rojo);background:#fff5f5}
  .error-msg{color:var(--brand-rojo);font-size:12px;margin-top:4px;display:none;font-weight:600}

  .result-badge{display:inline-flex;align-items:center;gap:8px;padding:8px 20px;border-radius:50px;font-size:13px;font-weight:800;text-transform:uppercase;letter-spacing:1px;margin-bottom:20px}
  .result-message{font-size:16px;line-height:1.8;margin-bottom:28px;padding:24px;border-radius:var(--radius-md);text-align:left}
  
  /* ESTILOS PARA EL REPORTE GENERADO POR IA */
  .ai-report-container { background: #fdfdfe; border: 2px solid var(--brand-morado); border-radius: var(--radius-lg); padding: 36px; text-align: left; margin-bottom: 30px; box-shadow: var(--shadow-md); position: relative; overflow: hidden; }
  .ai-report-container::before { content:''; position: absolute; top: 0; left: 0; width: 6px; height: 100%; background: var(--brand-morado); }
  .ai-report-container h3 { color: var(--navy); font-size: 20px; margin-top: 28px; margin-bottom: 12px; font-weight: 800; }
  .ai-report-container h3:first-child { margin-top: 0; color: var(--brand-morado); font-size: 24px; border-bottom: 2px solid var(--border-light); padding-bottom: 12px; margin-bottom: 20px; }
  .ai-report-container p { font-size: 15px; line-height: 1.75; margin-bottom: 16px; color: var(--text); }
  .ai-report-container ul { margin-bottom: 20px; padding-left: 20px; }
  .ai-report-container li { font-size: 15px; margin-bottom: 8px; line-height: 1.6; color: var(--text); }
  .ai-report-container strong { color: var(--navy); font-weight: 700; }

  .partner-banner{display:flex;align-items:center;gap:16px;background:linear-gradient(135deg,var(--navy3),var(--navy));padding:20px 24px;border-radius:var(--radius-md);margin-bottom:20px;text-align:left}
  .partner-logos{display:flex;flex-direction:column;align-items:center;gap:8px;flex-shrink:0}
  .partner-banner img{height:48px;border-radius:8px;background:#fff;padding:6px 10px;flex-shrink:0}
  .partner-banner-text{color:rgba(255,255,255,.85);font-size:13px;line-height:1.6}
  .partner-banner-text strong{color:#fff;display:block;font-size:14px;margin-bottom:2px}

  .gauge-container{display:flex;justify-content:center;margin-bottom:32px}
  .gauge-svg{width:220px;height:130px}
  .gauge-bg{fill:none;stroke:var(--border);stroke-width:14;stroke-linecap:round}
  .gauge-fill{fill:none;stroke-width:14;stroke-linecap:round;transition:stroke-dashoffset 1.5s cubic-bezier(.16,1,.3,1),stroke .5s}
  .gauge-text{font-family:'Plus Jakarta Sans',sans-serif;font-weight:900;font-size:36px;fill:var(--navy);text-anchor:middle}
  .gauge-label{font-family:'DM Sans',sans-serif;font-size:11px;fill:var(--muted);text-anchor:middle;font-weight:600;text-transform:uppercase;letter-spacing:1px}

  .phase-breakdown{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:28px}
  .pb-item{padding:14px 8px;border-radius:var(--radius-sm);text-align:center}
  .pb-score{font-size:22px;font-weight:900;display:block}
  .pb-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.3px;opacity:.8}

  .btn-primary{display:inline-flex;align-items:center;justify-content:center;gap:8px;background:var(--navy);color:#fff;padding:16px 32px;border-radius:var(--radius-sm);font-size:15px;font-weight:700;border:none;cursor:pointer;transition:all .25s;font-family:inherit;width:100%;letter-spacing:.01em}
  .btn-primary:hover{background:var(--navy2);transform:translateY(-1px);box-shadow:var(--shadow-md)}
  .btn-secondary{display:inline-flex;align-items:center;justify-content:center;gap:8px;background:transparent;color:var(--muted);padding:14px 24px;border-radius:var(--radius-sm);font-size:14px;font-weight:600;border:2px solid var(--border);cursor:pointer;transition:all .2s;font-family:inherit}
  .btn-secondary:hover{border-color:var(--navy);color:var(--navy)}
  .btn-cta-big{display:flex;align-items:center;justify-content:center;gap:10px;background:var(--brand-rojo);color:#fff;padding:20px 36px;border-radius:var(--radius-md);font-size:17px;font-weight:800;text-decoration:none;transition:all .3s;box-shadow:0 6px 20px rgba(214,34,22,.25);margin-top:20px;border:none;cursor:pointer;width:100%;font-family:inherit;letter-spacing:.01em}
  .btn-cta-big:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(214,34,22,.35);background:#c01e14}

  .step-nav{display:flex;gap:12px;margin-top:32px}
  .step-nav .btn-primary{flex:1}

  @keyframes confetti-fall{0%{transform:translateY(-10px) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
  .confetti{position:fixed;top:-10px;width:10px;height:10px;z-index:9999;pointer-events:none;animation:confetti-fall 3s ease-in forwards}

  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px}

  @media(max-width:640px){
    .step-card{padding:28px 20px}
    .chips{gap:8px}.chip{padding:9px 14px;font-size:13px}
    .phase-breakdown{grid-template-columns:repeat(3,1fr);gap:6px}
    .step-nav{flex-direction:column}.step-nav .btn-secondary{order:1}
    .quiz-wrapper{padding:80px 16px 40px}
    .form-row{grid-template-columns:1fr}
    .partner-banner{flex-direction:column;text-align:center}
    .ai-report-container { padding: 24px 20px; }
  }
</style>
</head>
<body>

<nav>
  <div class="nav-inner">
    <a href="index.html" style="display:flex;align-items:center;text-decoration:none;">
      <img src="assets/mas-logo.svg" alt="MAS Consultores" style="height:44px;">
    </a>
    <a class="nav-back" href="index.html">&larr; Volver al sitio</a>
  </div>
</nav>

<div class="quiz-wrapper">

  <div class="progress-container">
    <div class="progress-header">
      <span class="progress-label">Diagn√≥stico ROI ‚Äî Metodolog√≠a Phillips</span>
      <span class="progress-step-text" id="progressText">Paso 1 de 6</span>
    </div>
    <div class="progress-bar-track">
      <div class="progress-bar-fill" id="progressFill" style="width:16.6%;background:var(--navy);"></div>
    </div>
  </div>

  <div class="step active" id="step1">
    <div class="step-card">
      <span class="step-icon">&#128202;</span>
      <h2 class="step-title">Perfil Organizacional</h2>
      <p class="step-subtitle">Antes de evaluar tu madurez ROI, necesitamos conocer el contexto de tu organizaci√≥n. Esto nos permite entregar un diagn√≥stico relevante a tu realidad.</p>

      <div class="question-group">
        <span class="question-label">Rubro / Industria</span>
        <div class="chips" data-group="rubro">
          <button class="chip" type="button">Banca y Finanzas</button>
          <button class="chip" type="button">Miner√≠a y Energ√≠a</button>
          <button class="chip" type="button">Retail y Consumo</button>
          <button class="chip" type="button">Telecomunicaciones</button>
          <button class="chip" type="button">Salud</button>
          <button class="chip" type="button">Tecnolog√≠a</button>
          <button class="chip" type="button">Educaci√≥n</button>
          <button class="chip" type="button">Sector P√∫blico</button>
          <button class="chip" type="button">Manufactura</button>
          <button class="chip" type="button">Servicios Profesionales</button>
          <button class="chip" type="button">Otro</button>
        </div>
      </div>

      <div class="question-group">
        <span class="question-label">¬øCu√°ntos colaboradores tiene tu organizaci√≥n?</span>
        <div class="chips" data-group="colaboradores">
          <button class="chip" type="button">1-50</button>
          <button class="chip" type="button">51-200</button>
          <button class="chip" type="button">201-1.000</button>
          <button class="chip" type="button">+1.000</button>
        </div>
      </div>

      <div class="question-group">
        <span class="question-label">¬øCu√°ntos a√±os lleva operando la organizaci√≥n?</span>
        <div class="chips" data-group="anos">
          <button class="chip" type="button">0-5 a√±os</button>
          <button class="chip" type="button">6-15 a√±os</button>
          <button class="chip" type="button">16-30 a√±os</button>
          <button class="chip" type="button">+30 a√±os</button>
        </div>
      </div>

      <div class="question-group">
        <span class="question-label">Tu cargo o rol principal</span>
        <div class="chips" data-group="cargo">
          <button class="chip" type="button">Gerente/Director de RRHH</button>
          <button class="chip" type="button">Jefe de Capacitaci√≥n</button>
          <button class="chip" type="button">BP / HRBP</button>
          <button class="chip" type="button">Analista de Desarrollo</button>
          <button class="chip" type="button">Gerencia General / C-Level</button>
          <button class="chip" type="button">Otro</button>
        </div>
      </div>

      <div class="question-group">
        <span class="question-label">Nivel principal al que destinan capacitaci√≥n</span>
        <div class="chips" data-group="nivel">
          <button class="chip" type="button">Operarios / Primera L√≠nea</button>
          <button class="chip" type="button">Administrativos</button>
          <button class="chip" type="button">Profesionales / Analistas</button>
          <button class="chip" type="button">Supervisores / Jefaturas</button>
          <button class="chip" type="button">Gerencia / Alta Direcci√≥n</button>
          <button class="chip" type="button">Transversal (todos los niveles)</button>
        </div>
      </div>

      <div class="question-group">
        <span class="question-label">Presupuesto anual aproximado en capacitaci√≥n</span>
        <div class="chips" data-group="presupuesto">
          <button class="chip" type="button">No tenemos asignado</button>
          <button class="chip" type="button">Menos de $20M CLP</button>
          <button class="chip" type="button">$20M - $100M CLP</button>
          <button class="chip" type="button">$100M - $500M CLP</button>
          <button class="chip" type="button">M√°s de $500M CLP</button>
        </div>
      </div>

      <div class="step-nav">
        <button class="btn-primary" onclick="goToStep(2)">Comenzar evaluaci√≥n de madurez &rarr;</button>
      </div>
    </div>
  </div>

  <div class="step" id="step2">
    <div class="step-card">
      <span class="step-icon">&#9989;</span>
      <h2 class="step-title">Niveles 1 y 2 ‚Äî Reacci√≥n y Aprendizaje</h2>
      <p class="step-subtitle">Marca las pr√°cticas que tu organizaci√≥n realiza de manera <strong>consistente y documentada</strong>. Si ninguna aplica a tu caso, no te preocupes: simplemente avanza al siguiente paso. La honestidad hace m√°s preciso tu diagn√≥stico.</p>

      <div class="check-counter" id="counter2">
        <span>Pr√°cticas confirmadas:</span>
        <span class="count-num" id="countNum2">0</span>
        <span>de 8</span>
      </div>

      <div class="phase-header">
        <div class="phase-dot" style="background:var(--nivel1);"></div>
        <span class="phase-name" style="color:var(--nivel1);">Nivel 1 ‚Äî Reacci√≥n y Satisfacci√≥n</span>
        <span class="phase-desc">Phillips L1</span>
      </div>
      <label class="check-item" style="color:var(--nivel1);" data-level="1">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Aplicamos encuestas de satisfacci√≥n estandarizadas al finalizar cada programa.</span>
      </label>
      <label class="check-item" style="color:var(--nivel1);" data-level="1">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Medimos la relevancia percibida del contenido para el puesto de trabajo (no solo "me gust√≥").</span>
      </label>
      <label class="check-item" style="color:var(--nivel1);" data-level="1">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Evaluamos la intenci√≥n de aplicar lo aprendido con preguntas espec√≠ficas de acci√≥n.</span>
      </label>
      <label class="check-item" style="color:var(--nivel1);" data-level="1">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Consolidamos y analizamos los datos de reacci√≥n para tomar decisiones sobre futuros programas.</span>
      </label>

      <div class="phase-header phase-divider">
        <div class="phase-dot" style="background:var(--nivel2);"></div>
        <span class="phase-name" style="color:var(--nivel2);">Nivel 2 ‚Äî Aprendizaje</span>
        <span class="phase-desc">Phillips L2</span>
      </div>
      <label class="check-item" style="color:var(--nivel2);" data-level="2">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Aplicamos evaluaciones de conocimiento (pre y post) para medir el aprendizaje real.</span>
      </label>
      <label class="check-item" style="color:var(--nivel2);" data-level="2">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Utilizamos simulaciones, role-plays o pruebas pr√°cticas para evaluar habilidades adquiridas.</span>
      </label>
      <label class="check-item" style="color:var(--nivel2);" data-level="2">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Nuestro LMS o plataforma entrega reportes de completitud, puntajes y estancamiento por usuario.</span>
      </label>
      <label class="check-item" style="color:var(--nivel2);" data-level="2">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Los dise√±os instruccionales se alinean con objetivos de aprendizaje medibles (no gen√©ricos).</span>
      </label>

      <div class="step-nav">
        <button class="btn-secondary" onclick="goToStep(1)">&larr; Volver</button>
        <button class="btn-primary" onclick="goToStep(3)">Siguiente: Niveles 3 y 4 &rarr;</button>
      </div>
    </div>
  </div>

  <div class="step" id="step3">
    <div class="step-card">
      <span class="step-icon">&#128200;</span>
      <h2 class="step-title">Niveles 3 y 4 ‚Äî Aplicaci√≥n e Impacto</h2>
      <p class="step-subtitle">Estos niveles miden la transferencia real al puesto de trabajo y el impacto en indicadores del negocio. Si ninguna aplica, avanza sin problema: esto indica d√≥nde est√°n las oportunidades m√°s grandes.</p>

      <div class="check-counter" id="counter3">
        <span>Pr√°cticas confirmadas:</span>
        <span class="count-num" id="countNum3">0</span>
        <span>de 8</span>
      </div>

      <div class="phase-header">
        <div class="phase-dot" style="background:var(--nivel3);"></div>
        <span class="phase-name" style="color:var(--nivel3);">Nivel 3 ‚Äî Aplicaci√≥n e Implementaci√≥n</span>
        <span class="phase-desc">Phillips L3</span>
      </div>
      <label class="check-item" style="color:var(--nivel3);" data-level="3">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Los participantes terminan cada programa con un plan de acci√≥n concreto a 30-60 d√≠as.</span>
      </label>
      <label class="check-item" style="color:var(--nivel3);" data-level="3">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Los jefes directos participan activamente (pre-briefing y post-seguimiento de la capacitaci√≥n).</span>
      </label>
      <label class="check-item" style="color:var(--nivel3);" data-level="3">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Realizamos evaluaciones de seguimiento a los 60-90 d√≠as para medir cambio de comportamiento.</span>
      </label>
      <label class="check-item" style="color:var(--nivel3);" data-level="3">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Identificamos y documentamos las barreras y facilitadores de la aplicaci√≥n en el puesto.</span>
      </label>

      <div class="phase-header phase-divider">
        <div class="phase-dot" style="background:var(--nivel4);"></div>
        <span class="phase-name" style="color:var(--nivel4);">Nivel 4 ‚Äî Impacto en el Negocio</span>
        <span class="phase-desc">Phillips L4</span>
      </div>
      <label class="check-item" style="color:var(--nivel4);" data-level="4">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Definimos KPIs de negocio vinculados al programa ANTES de ejecutar la capacitaci√≥n.</span>
      </label>
      <label class="check-item" style="color:var(--nivel4);" data-level="4">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Documentamos la "l√≠nea base" de esos KPIs para comparar el antes y despu√©s.</span>
      </label>
      <label class="check-item" style="color:var(--nivel4);" data-level="4">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Aplicamos m√©todos para aislar los efectos de la capacitaci√≥n de otros factores (estimaci√≥n, grupo control, an√°lisis de tendencia).</span>
      </label>
      <label class="check-item" style="color:var(--nivel4);" data-level="4">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Reportamos el impacto en indicadores operativos al equipo directivo con datos concretos.</span>
      </label>

      <div class="step-nav">
        <button class="btn-secondary" onclick="goToStep(2)">&larr; Volver</button>
        <button class="btn-primary" onclick="goToStep(4)">Siguiente: Nivel 5 ‚Äî ROI &rarr;</button>
      </div>
    </div>
  </div>

  <div class="step" id="step4">
    <div class="step-card">
      <span class="step-icon">&#128176;</span>
      <h2 class="step-title">Nivel 5 ‚Äî Retorno de la Inversi√≥n (ROI)</h2>
      <p class="step-subtitle">El nivel m√°s alto de la Metodolog√≠a Phillips. Aqu√≠ se demuestra el valor financiero real de la capacitaci√≥n. Si ninguna aplica, no te preocupes: menos del 5% de las organizaciones en Latinoam√©rica opera a este nivel.</p>

      <div class="check-counter" id="counter4">
        <span>Pr√°cticas confirmadas:</span>
        <span class="count-num" id="countNum4">0</span>
        <span>de 4</span>
      </div>

      <div class="phase-header">
        <div class="phase-dot" style="background:var(--nivel5);"></div>
        <span class="phase-name" style="color:var(--nivel5);">Nivel 5 ‚Äî ROI Financiero</span>
        <span class="phase-desc">Phillips L5</span>
      </div>
      <label class="check-item" style="color:var(--nivel5);" data-level="5">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Convertimos las mejoras operativas a valores monetarios utilizando metodolog√≠as validadas.</span>
      </label>
      <label class="check-item" style="color:var(--nivel5);" data-level="5">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Calculamos el costo TOTAL del programa (dise√±o, ejecuci√≥n, tecnolog√≠a, horas-hombre, costo de oportunidad).</span>
      </label>
      <label class="check-item" style="color:var(--nivel5);" data-level="5">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Aplicamos la f√≥rmula de ROI: (Beneficios Netos / Costos) x 100 para obtener el porcentaje de retorno.</span>
      </label>
      <label class="check-item" style="color:var(--nivel5);" data-level="5">
        <span class="check-box"><svg viewBox="0 0 16 16"><path d="M3 8.5 L6.5 12 L13 4"/></svg></span>
        <span class="check-text">Presentamos un reporte financiero de ROI al C-Level o Directorio (no solo m√©tricas de horas o asistencia).</span>
      </label>

      <div class="step-nav">
        <button class="btn-secondary" onclick="goToStep(3)">&larr; Volver</button>
        <button class="btn-primary" onclick="goToStep(5)">Ver mi resultado &rarr;</button>
      </div>
    </div>
  </div>

  <div class="step" id="step5">
    <div class="step-card" style="text-align:center;">
      <div class="lead-icon">&#128274;</div>
      <h2 class="step-title">¬°Tu diagn√≥stico est√° listo!</h2>
      <p class="step-subtitle" style="max-width:440px;margin:0 auto 32px;">Ingresa tus datos para ver tu puntaje seg√∫n la Metodolog√≠a ROI de Phillips y recibir un Business Case personalizado mediante IA.</p>

      <div style="text-align:left;">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label" for="leadNombre">Nombre completo *</label>
            <input class="form-input" id="leadNombre" type="text" placeholder="Tu nombre" required>
            <div class="error-msg" id="errorNombre">Este campo es obligatorio</div>
          </div>
          <div class="form-group">
            <label class="form-label" for="leadEmpresa">Empresa *</label>
            <input class="form-input" id="leadEmpresa" type="text" placeholder="Nombre de tu empresa">
            <div class="error-msg" id="errorEmpresa">Este campo es obligatorio</div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label" for="leadEmail">Email Corporativo *</label>
          <input class="form-input" id="leadEmail" type="email" placeholder="tu@empresa.cl" required>
          <div class="error-msg" id="errorEmail">Ingresa un email corporativo v√°lido</div>
        </div>
      </div>

      <div class="step-nav" style="flex-direction:column;gap:10px;">
        <button class="btn-primary" onclick="submitLead()" style="background:var(--brand-morado);font-size:16px;padding:18px;">&#128161; Generar Reporte Estrat√©gico (IA)</button>
        <button class="btn-secondary" onclick="goToStep(4)" style="width:100%;justify-content:center;">&larr; Volver al checklist</button>
      </div>
      <p style="color:var(--muted);font-size:12px;margin-top:16px;">&#128274; Tu informaci√≥n es confidencial y no ser√° compartida con terceros.</p>
    </div>
  </div>

  <div class="step" id="step6">
    <div class="step-card" style="text-align:center;">
      <div id="resultContent"></div>

      <a class="btn-cta-big" href="index.html#contacto" id="btn-final-contacto">
        &#128640; Agendar Reuni√≥n de Impacto con MAS
      </a>
      <button class="btn-secondary" onclick="downloadResultsPdf()" style="width:100%;margin-top:12px;justify-content:center;" id="btn-final-pdf">
        &#128190; Descargar Business Case en PDF
      </button>
      <button class="btn-secondary" onclick="resetQuiz()" style="width:100%;margin-top:12px;justify-content:center;" id="btn-final-reset">
        &#128260; Repetir diagn√≥stico
      </button>
    </div>
  </div>

</div>

<script>
// --- CONFIGURACI√ìN DE IA ---
const API_KEY = "AIzaSyDsS0RlgJkkWfebOxD8M_o0IUBwvPDHnww"; 

const profile = {};
let currentStep = 1;
const totalSteps = 6;

document.querySelectorAll('.chips').forEach(container => {
  const group = container.dataset.group;
  container.querySelectorAll('.chip').forEach(chip => {
    chip.addEventListener('click', () => {
      container.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
      chip.classList.add('selected');
      profile[group] = chip.textContent;
    });
  });
});

document.querySelectorAll('.check-item').forEach(item => {
  item.addEventListener('click', () => {
    item.classList.toggle('checked');
    updateCounters();
  });
});

function updateCounters() {
  const c2 = document.getElementById('countNum2');
  const c3 = document.getElementById('countNum3');
  const c4 = document.getElementById('countNum4');
  if(c2) c2.textContent = document.querySelectorAll('#step2 .check-item.checked').length;
  if(c3) c3.textContent = document.querySelectorAll('#step3 .check-item.checked').length;
  if(c4) c4.textContent = document.querySelectorAll('#step4 .check-item.checked').length;
}

function goToStep(n) {
  if (currentStep === 1 && n > 1) {
    if (!profile.colaboradores) {
      const el = document.querySelector('[data-group="colaboradores"]');
      el.style.outline = '2px solid var(--brand-rojo)';
      el.style.outlineOffset = '4px';
      el.style.borderRadius = '12px';
      setTimeout(() => el.style.outline = 'none', 2000);
      return;
    }
  }
  currentStep = n;
  document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
  document.getElementById('step' + n).classList.add('active');

  const pct = (n / totalSteps) * 100;
  const fill = document.getElementById('progressFill');
  fill.style.width = pct + '%';
  const colors = { 1:'var(--navy)', 2:'var(--nivel1)', 3:'var(--nivel3)', 4:'var(--nivel5)', 5:'var(--brand-morado)', 6:'var(--brand-verde)' };
  fill.style.background = colors[n] || 'var(--navy)';
  document.getElementById('progressText').textContent = 'Paso ' + n + ' de ' + totalSteps;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

async function submitLead() {
  const nombre = document.getElementById('leadNombre');
  const empresa = document.getElementById('leadEmpresa');
  const email = document.getElementById('leadEmail');
  let valid = true;

  [nombre, empresa].forEach(el => {
    const errId = 'error' + el.id.replace('lead','');
    if (!el.value.trim()) {
      el.classList.add('error');
      document.getElementById(errId).style.display = 'block';
      valid = false;
    } else {
      el.classList.remove('error');
      document.getElementById(errId).style.display = 'none';
    }
  });

  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
    email.classList.add('error');
    document.getElementById('errorEmail').style.display = 'block';
    valid = false;
  } else {
    email.classList.remove('error');
    document.getElementById('errorEmail').style.display = 'none';
  }

  if (!valid) return;
  profile.nombre = nombre.value.trim();
  profile.empresa = empresa.value.trim();
  profile.email = email.value.trim();

  // Esconder botones de acci√≥n hasta que est√© listo
  document.getElementById('btn-final-contacto').style.display = 'none';
  document.getElementById('btn-final-pdf').style.display = 'none';
  document.getElementById('btn-final-reset').style.display = 'none';

  // Mostrar Loading
  document.getElementById('resultContent').innerHTML = `
    <div style="padding: 60px 20px; text-align: center;">
      <div style="font-size: 40px; margin-bottom: 20px; animation: pulse 1.5s infinite;">ü§ñ</div>
      <h3 style="color: var(--navy); margin-bottom: 10px;">Redactando tu Business Case con IA...</h3>
      <p style="color: var(--muted); font-size: 14px;">Estamos estructurando el informe estrat√©gico en base a tus respuestas.</p>
    </div>
    <style>@keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.15);} 100% {transform: scale(1);} }</style>
  `;
  goToStep(6);

  await calculateResults();
  launchConfetti();

  // Mostrar botones despu√©s de generar reporte
  document.getElementById('btn-final-contacto').style.display = 'flex';
  document.getElementById('btn-final-pdf').style.display = 'flex';
  document.getElementById('btn-final-reset').style.display = 'flex';
}

function buildExecutiveReportPrompt(profileData, checklistSnapshot) {
  const identity = `Nombre: ${profileData.nombre || 'No informado'}
Empresa: ${profileData.empresa || 'No informada'}
Cargo: ${profileData.cargo || 'No informado'}
Tama√±o: ${profileData.colaboradores || 'No informado'}
Industria: ${profileData.rubro || 'No informada'}
Presupuesto: ${profileData.presupuesto || 'No informado'}`;

  let checklistDetail = '';
  Object.keys(checklistSnapshot.levelNames).forEach(level => {
    const levelTitle = checklistSnapshot.levelNames[level];
    const checked = checklistSnapshot.selected[level] || [];
    const unchecked = checklistSnapshot.unselected[level] || [];
    checklistDetail += `${levelTitle}\n`;
    checklistDetail += `- Pr√°cticas CHECKED (Lo que S√ç hacen): ${checked.length ? checked.join(' | ') : 'Ninguna'}\n`;
    checklistDetail += `- Pr√°cticas NO CHECKED (Brechas): ${unchecked.length ? unchecked.join(' | ') : 'Ninguna'}\n\n`;
  });

  return `Act√∫a como un Director de Consultor√≠a Experto en la Metodolog√≠a ROI de Phillips y Estratega de Talento Organizacional.

Voy a entregarte los resultados de un "Diagn√≥stico de Madurez ROI" completado por un usuario. Tu objetivo es redactar un informe ejecutivo, estrat√©gico y persuasivo analizando sus respuestas.

OBJETIVO CR√çTICO DEL INFORME:
Este informe no solo lo leer√° el usuario que complet√≥ el test; ser√° utilizado por √©l/ella como "Champion" (promotor interno) para mostr√°rselo a sus pares, a la Gerencia General (CEO) o a la Gerencia de Finanzas (CFO). Por lo tanto, el documento debe funcionar como un "Business Case" que justifique la urgencia de cambiar su modelo de capacitaci√≥n y demuestre que MAS Consultores es el √∫nico aliado seguro para hacerlo.

Contexto de tu empresa: 
Representas a "MAS Consultores", el √∫nico partner oficial del ROI Institute en Latinoam√©rica, con m√°s de 30 a√±os de experiencia instalando capacidades y ecosistemas de aprendizaje (Consultor√≠a, Formaci√≥n, Plataformas LMS y Medici√≥n ROI Nivel 5).

Instrucciones estructurales para redactar el informe:

1. Tono y Audiencia Dual:
Dir√≠gete al usuario por su nombre ("t√∫"), pero utiliza un lenguaje financiero, de negocios y de gesti√≥n de riesgos tan contundente que cualquier Director que lea el informe entienda la urgencia. Habla de "fuga de capital", "gasto ciego en talento", "retorno de inversi√≥n", "alineaci√≥n estrat√©gica" y "ventaja competitiva".

2. El Business Case (El riesgo de no actuar):
Comienza contextualizando el tama√±o de su empresa y su presupuesto. Explica por qu√© seguir capacitando sin llegar a los Niveles 4 (Impacto) y 5 (ROI Financiero) es un riesgo estructural. Dale al Champion argumentos irrebatibles: "Cada mill√≥n invertido sin trazabilidad al puesto de trabajo es presupuesto perdido". Hazle ver a la gerencia que el modelo actual es ineficiente.

3. Resumen del Diagn√≥stico (Brechas y Puntos Ciegos):
Toma sus respuestas y destaca lo que S√ç hacen bien (ej. Reacci√≥n y Aprendizaje), pero exp√≥n con crudeza las brechas en Transferencia (Nivel 3) y ROI (Niveles 4 y 5). 

4. Gu√≠a Estrat√©gica (El "Qu√©", pero NUNCA el "C√≥mo"):
Entrega una hoja de ruta abstracta de 3 o 4 pasos (ej. "Aislar los efectos de la capacitaci√≥n", "Vincular el dise√±o instruccional a los KPIs operativos"). 
IMPORTANTE: Explica muy bien QU√â deben lograr para ser rentables, pero omite deliberadamente la explicaci√≥n de C√ìMO se hace t√°cticamente. Genera la sensaci√≥n de que es un proceso metodol√≥gico de alta ingenier√≠a para el cual necesitan expertos.

5. Credenciales y Autoridad (Por qu√© MAS Consultores):
Esta secci√≥n es vital para convencer a la gerencia. Argumenta por qu√© este ecosistema NO debe construirse improvisando con recursos internos o proveedores gen√©ricos. Posiciona expl√≠citamente a MAS Consultores como la √∫nica opci√≥n l√≥gica destacando:
- Que somos el √öNICO partner oficial del ROI Institute y Jack Phillips en Latinoam√©rica.
- Nuestros 30 a√±os de experiencia demostrable.
- Que no entregamos "cursos", sino que "instalamos capacidades y procesos" para que el cambio sea sostenible.
- La integraci√≥n de tecnolog√≠a √°gil (como IA y Colossyan) sumada a la medici√≥n cient√≠fica.

6. Cierre y Llamado a la Acci√≥n (Para el Champion y su Jefatura):
Concluye empoderando al usuario. Sugi√©rele que este diagn√≥stico es el primer paso para transformar a RRHH en un socio estrat√©gico del negocio. Inv√≠talo a √©l y a su equipo directivo a agendar una "Reuni√≥n de Diagn√≥stico de Impacto" con nuestros directores para trazar un roadmap de 90 d√≠as.

INSTRUCCI√ìN CR√çTICA DE FORMATO DE SALIDA:
Devuelve tu reporte formateado √öNICAMENTE en HTML estructurado limpio. 
- Utiliza <h3> para los t√≠tulos de cada una de las 6 secciones.
- Utiliza <p> para los p√°rrafos, asegurando que sean f√°ciles de leer.
- Utiliza <ul> y <li> para listas de vi√±etas.
- Utiliza <strong> para resaltar las frases y argumentos clave (como "fuga de capital").
¬°MUY IMPORTANTE!: NO agregues las etiquetas \`\`\`html al principio ni \`\`\` al final del texto. Devuelve SOLO el c√≥digo HTML crudo para que pueda inyectarse directamente en la p√°gina web.

---
DATOS DEL USUARIO A ANALIZAR:
${identity}

DETALLE EXACTO DE LAS PR√ÅCTICAS CHECKEADAS Y NO CHECKEADAS:
${checklistDetail}`;
}

async function fetchAIAnalysis(promptText) {
  if (!API_KEY) {
    console.error("Falta la API Key");
    return null;
  }
  try {
    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{ parts: [{ text: promptText }] }]
      })
    });
    
    const data = await response.json();

    if (!response.ok) {
      console.error("‚ùå Google Gemini rechaz√≥ la petici√≥n. Motivo:", data.error?.message || "Error desconocido");
      return null;
    }

    let textResult = data.candidates[0].content.parts[0].text;
    
    // Limpieza de formato Markdown si la IA llega a agregarlo accidentalmente
    textResult = textResult.replace(/^```html\n?/i, '').replace(/\n?```$/i, '');
    return textResult;
  } catch (e) {
    console.error("‚ùå Error de red o al procesar la IA:", e);
    return null;
  }
}

async function calculateResults() {
  const allChecked = document.querySelectorAll('.check-item.checked');
  const total = allChecked.length;
  const maxScore = 20;
  const levels = { 1:0, 2:0, 3:0, 4:0, 5:0 };
  allChecked.forEach(item => { const l = item.dataset.level; if(l) levels[l]++; });

  // Preparar Prompt
  const checklistSnapshot = getChecklistSnapshotForPrompt();
  const prompt = buildExecutiveReportPrompt(profile, checklistSnapshot);
  
  // Llamada a la IA para obtener el reporte en HTML
  const aiReportHtml = await fetchAIAnalysis(prompt);

  // Fallback visual en caso de que falle la IA
  let finalReportBlock = "";
  if (aiReportHtml) {
    finalReportBlock = `
      <div class="ai-report-container">
        ${aiReportHtml}
      </div>
    `;
  } else {
    finalReportBlock = `
      <div class="ai-report-container">
        <h3>Informe no disponible temporalmente</h3>
        <p>Revisa la consola (F12) para ver por qu√© fall√≥ la conexi√≥n con la IA.</p>
        <p>No se pudo generar el reporte automatizado, pero te recomendamos agendar una reuni√≥n directa con nosotros para analizar tus resultados a fondo.</p>
      </div>
    `;
  }

  const html = `
    <div style="margin-bottom: 24px;">
      <h2 style="color: var(--navy); font-size: 28px;">Reporte Ejecutivo ROI</h2>
      <p style="color: var(--muted); font-size: 14px;">Generado estrat√©gicamente para el equipo directivo de <strong>${escapeHTML(profile.empresa || 'tu organizaci√≥n')}</strong></p>
    </div>
    
    <div class="gauge-container">
      <svg class="gauge-svg" viewBox="0 0 200 120">
        <path class="gauge-bg" d="M 20 100 A 80 80 0 0 1 180 100"/>
        <path class="gauge-fill" d="M 20 100 A 80 80 0 0 1 180 100" stroke="var(--brand-morado)" stroke-dasharray="251" stroke-dashoffset="${251 - (total / maxScore) * 251}"/>
        <text class="gauge-text" x="100" y="90">${total}</text>
        <text class="gauge-label" x="100" y="110">PUNTOS DE MADUREZ</text>
      </svg>
    </div>
    <div class="phase-breakdown">
      <div class="pb-item" style="background:#f9f0fa;color:var(--nivel1);"><span class="pb-score">${levels[1]}/4</span><span class="pb-label">N1 Reacci√≥n</span></div>
      <div class="pb-item" style="background:#fef8e6;color:#b8860b;"><span class="pb-score">${levels[2]}/4</span><span class="pb-label">N2 Aprendizaje</span></div>
      <div class="pb-item" style="background:#e6f7ed;color:var(--nivel3);"><span class="pb-score">${levels[3]}/4</span><span class="pb-label">N3 Aplicaci√≥n</span></div>
      <div class="pb-item" style="background:#fde8e6;color:var(--nivel4);"><span class="pb-score">${levels[4]}/4</span><span class="pb-label">N4 Impacto</span></div>
      <div class="pb-item" style="background:#eef1fa;color:var(--nivel5);"><span class="pb-score">${levels[5]}/4</span><span class="pb-label">N5 ROI</span></div>
    </div>
    
    ${finalReportBlock}

    <div class="partner-banner">
      <div class="partner-logos">
        <img src="assets/mas-logo.svg" alt="MAS Consultores">
        <img src="assets/roi-logo.svg" alt="ROI Institute">
      </div>
      <div class="partner-banner-text">
        <strong>MAS Consultores ‚Äî √önico Partner Oficial del ROI Institute en Latinoam√©rica</strong>
        Somos el √∫nico partner certificado por Jack Phillips en la regi√≥n desde 2003. Instalamos capacidades para que tu organizaci√≥n pueda medir el retorno de la inversi√≥n de forma aut√≥noma y con validez global.
      </div>
    </div>
  `;

  document.getElementById('resultContent').innerHTML = html;
}

function getChecklistSnapshotForPrompt() {
  const levelNames = { 1: 'Nivel 1 ‚Äî Reacci√≥n', 2: 'Nivel 2 ‚Äî Aprendizaje', 3: 'Nivel 3 ‚Äî Aplicaci√≥n', 4: 'Nivel 4 ‚Äî Impacto', 5: 'Nivel 5 ‚Äî ROI' };
  const selected = { 1: [], 2: [], 3: [], 4: [], 5: [] };
  const unselected = { 1: [], 2: [], 3: [], 4: [], 5: [] };

  document.querySelectorAll('.check-item').forEach(item => {
    const level = item.dataset.level;
    if (!level || !selected[level]) return;
    const text = item.querySelector('.check-text')?.textContent?.trim();
    if (!text) return;
    if (item.classList.contains('checked')) selected[level].push(text);
    else unselected[level].push(text);
  });
  return { levelNames, selected, unselected };
}

// NUEVO GENERADOR DE PDF EXACTO
async function downloadResultsPdf() {
  if (!window.jspdf || !window.html2canvas) {
    alert('No fue posible generar el PDF en este momento. Intenta nuevamente.');
    return;
  }

  // Ocultar botones temporalmente para que no salgan en el PDF impreso
  const buttonsToHide = document.querySelectorAll('#btn-final-contacto, #btn-final-pdf, #btn-final-reset');
  buttonsToHide.forEach(btn => btn.style.display = 'none');

  const targetNode = document.querySelector('#step6 .step-card');
  
  // Breve espera para asegurar que el DOM se pint√≥ sin botones
  await new Promise(resolve => setTimeout(resolve, 150));

  const canvas = await window.html2canvas(targetNode, {
    scale: 2, // Mejor resoluci√≥n para lectura de texto
    useCORS: true,
    backgroundColor: '#ffffff'
  });

  // Mostrar los botones nuevamente en la web
  buttonsToHide.forEach(btn => btn.style.display = 'flex');

  const imgData = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('p', 'mm', 'a4');
  
  const pdfWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();
  
  // Ratio de escalado
  const imgRatio = canvas.height / canvas.width;
  const imgHeight = pdfWidth * imgRatio;

  let heightLeft = imgHeight;
  let position = 0;

  // Renderizar la primera p√°gina
  pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, imgHeight);
  heightLeft -= pageHeight;

  // A√±adir p√°ginas din√°micamente si el reporte de IA es muy largo
  while (heightLeft > 0) {
    position = heightLeft - imgHeight;
    pdf.addPage();
    pdf.addImage(imgData, 'PNG', 0, position, pdfWidth, imgHeight);
    heightLeft -= pageHeight;
  }

  const safeName = (profile.empresa || 'empresa').toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');
  pdf.save('Business-Case-ROI-' + safeName + '.pdf');
}

function launchConfetti() {
  const colors=['#833d8e','#edb321','#009739','#d62216','#23398d','#1a2e4a'];
  for(let i=0;i<50;i++){
    const el=document.createElement('div');
    el.className='confetti';
    el.style.left=Math.random()*100+'vw';
    el.style.background=colors[Math.floor(Math.random()*colors.length)];
    el.style.width=(Math.random()*8+6)+'px';
    el.style.height=(Math.random()*8+6)+'px';
    el.style.borderRadius=Math.random()>.5?'50%':'2px';
    el.style.animationDuration=(Math.random()*2+2)+'s';
    el.style.animationDelay=(Math.random()*.8)+'s';
    document.body.appendChild(el);
    setTimeout(()=>el.remove(),4000);
  }
}

function resetQuiz() {
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('selected'));
  document.querySelectorAll('.check-item').forEach(c=>c.classList.remove('checked'));
  ['leadNombre','leadEmpresa','leadEmail'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  ['countNum2','countNum3','countNum4'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent='0';});
  Object.keys(profile).forEach(k=>delete profile[k]);
  goToStep(1);
}

function escapeHTML(str){const d=document.createElement('div');d.textContent=str;return d.innerHTML;}
</script>
</body>
</html>
